{
  "hash": "3d0b9fed8c258a7ab09a943675dd4181",
  "result": {
    "markdown": "---\ntitle: \"ML for Big Pharma\"\nauthor: \"Orin Crouse\"\ndate: 08/07/2025\ndate-format: \"DD/MM/YYYY\"\nformat:\n  html:\n    code-fold: true\n    code-tools: true\neditor: visual\nexecute: \n  echo: false\n  enabled: true\n---\n\n::: {.cell}\n\n:::\n\n\n# Leveraging Machine Learning to Optimize Prescription Drug Pricing in Pharmacies\n\n## Abstract\n\nThis paper aims to find out how pharmacies set their drug prices to reflect what is happening around them. We first want to see how inflation affects the producer price index for all commodities and for pharmaceutical preparation manufacturing. This is done in hopes to see how much inflation takes place for pricing. Next we will use inflation over the last 5 years and see how one drug price is affected, and then to all drug pricing that is reported. Hopefully machine learning can help not only pharmacies choose pricing, but also help consumers understand the changes in pricing.\n\n## Introduction\n\nThis study explores the relationship between macroeconomic indicators---specifically inflation and production costs---and prescription drug pricing. Using data from June 2020 to January 2025, we combine the National Average Drug Acquisition Cost (NADAC), the Producer Price Index (PPI) for all commodities and Pharmaceutical Preparation Manufacturing (PPIPPM), and inflation expectations. The goal is to identify trends that could inform predictive models, allowing pharmaceutical companies to better anticipate changes in pricing and improve profit management.\n\n## Literature Review\n\nWe use NADAC rather than the Average Wholesale Price (AWP), as discussed in the Capital Rx article *What is NADAC & How Does It Differ From AWP?*, which states: \\\"AWP is an artificial number that is generally highly inflated from the manufacturer\\'s price\\\" (CapRx.com, 3rd paragraph). The article notes that while consumer-facing prices have remained relatively consistent over the past seven years, NADAC has declined by approximately 55% during the same period.\n\nAdditionally, the Ohio State University College of Pharmacy\\'s article *Shedding Light on NADAC* emphasizes how NADAC, though voluntary, provides a useful pricing benchmark. The paper also highlights proposed legislation to mandate pharmacy participation, but warns that \\\"transparency alone is not enough\\\" (Murphy & Rodis, final paragraph). This suggests a need for additional tools---such as machine learning---to better understand and forecast price dynamics.\n\n## Data\n\nWe collected data from FRED (Federal Reserve Bank of St. Louis) for PPI across all commodities (PPIALL) and pharmaceutical preparation manufacturing (PPIPPM), along with inflation tracking data. NADAC data was sourced from Medicaid.gov. The chosen timeframe---from June 1, 2020 to January 1, 2025---excludes early pandemic volatility to reduce noise. One-off drug entries were excluded to avoid extreme outliers and ensure we focus on consistent pricing trends.\n\n### Data inspection\n\nThe standardized monthly percentage changes in inflation, PPIALL, and PPIPPM reveal distinct volatility patterns. Notably, inflation appears to have a weak correlation with PPIPPM, though one might expect pharmaceutical prices to mirror broader commodity trends. The computed Pearson correlation coefficients show moderate correlation between inflation and PPIALL (0.36), and weak correlations between the other variable pairs (around 0.26). This suggests inflation moderately impacts overall commodity prices but has limited direct influence on pharmaceutical-specific indices.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Big-Pharma_files/figure-html/compar plot-1.png){width=672}\n:::\n:::\n\n\nWith the above graph, you can see that inflation doesn't seem to directly affect PPIALL or PPIPPM. But also, PPIPPM is a commodity that is captured in PPIALL. Thinking about that, at face value, one would expect to see PPIALL to be correlated to PPIPPM. Let's see the correlation.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Big-Pharma_files/figure-html/corr_viz-1.png){width=672}\n:::\n:::\n\n\nWe see with a correlation of 0.36, Inflation is most correlated to PPIALL, and vice versa. While the we see Inflation is correlated to PPIPPM at 0.26 and the same for PPIPPM to PPIALL. These show there is moderate positive correlation from Inflation to PPIALL, meaning as one goes up, the other will also go up, just moderately. The other show weak positive correlation, meaning if one goes up, the other could go up, but not by much. We take this as Inflation wouldn't affect PPIPPM and PPIPPM wouldn't affect PPIALL, or at least as much as we would have hoped for. Let's see though, how much Inflation and PPIPPM will change PPIALL. We hope to see that both will change the PPIALL.\n\n### Modeling Selection\n\nWe begin modeling using K-Nearest Neighbors (KNN) with Leave-One-Out Cross-Validation (LOOCV), identifying the optimal number of neighbors as k=20.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Big-Pharma_files/figure-html/choose_k-1.png){width=672}\n:::\n:::\n\n\nNow let's apply the best k and see what we get.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Big-Pharma_files/figure-html/knn_reg_best_k-1.png){width=672}\n:::\n:::\n\n\nWe see the positive trend that we expected. As Inflation and PPIPPM increase, PPIALL is expected to change in a positive way. Though we do not see this a very good model. Let's try some more. In fact, let's try Linear Regression, Random Forest, and XGBoost and compare the root mean square error (RMSE) where we want the model with the lowest value here.\n\n### Model Comparison Selection\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n              Model Train_RMSE Test_RMSE\n1 Linear Regression  1.3974481  1.232874\n2     Random Forest  0.6871463  1.291059\n3           XGBoost  0.9557678  1.181240\n```\n:::\n:::\n\n\nBased on the RMSE values, XGBoost outperforms the other models on test data. We therefore use XGBoost to model PPIALL as a function of PPIPPM and inflation.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Big-Pharma_files/figure-html/xg_old_plot-1.png){width=672}\n:::\n:::\n\n\nNow we think, which feature is more important for predicting change in PPIALL, Inflation or PPIPPM?\n\n### Feature Importance\n\nLet use recursive feature elimination (RFE) for the XGBoost.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Big-Pharma_files/figure-html/rfe-1.png){width=672}\n:::\n:::\n\n\nWe apply inflation as a predictor to estimate future NADAC values for Esomeprazole 20MG capsules---the most frequently reported drug in our dataset. The model shows that as inflation rises, NADAC values trend upward, supporting the idea that pharmacies may adjust costs in response to economic conditions.\n\n### Predicting Drug Prices Using Inflation\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Big-Pharma_files/figure-html/inflation to predict eso-1.png){width=672}\n:::\n:::\n\n\nWhen generalized to all drugs in the data set, the predictive model exhibits higher variance. This is likely due to irregularly reported and high-cost drugs skewing the results. Nevertheless, average NADAC values tend to track above inflation-predicted prices.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Big-Pharma_files/figure-html/inflation to predict all drugs-1.png){width=672}\n:::\n:::\n\n\nThere is more variance here. This most likely due to drugs that are reported less and cost more. But the overall looks like that NADAC prices are now above the predicted.\n\n## Conclusion\n\nThis study examined how inflation and production cost indicators influence drug pricing, using NADAC as the dependent variable. Our findings suggest that inflation moderately predicts PPIALL, and in turn, can be used to anticipate changes in drug pricing. However, variability across drug types---especially those with infrequent reporting or high prices---limits the precision of general predictions. Future research could focus on specific drug categories, incorporate additional economic variables (e.g., generic entry, policy changes), and explore international supply chain effects.\n\n## Works cited\n\nMedicaid.gov. \\\"National Average Drug Acquisition Cost.\\\" *Medicaid*, www.medicaid.gov/medicaid/nadac. Accessed 22 July 2025.\n\nFederal Reserve Eduction Department, Federal Reserve Bank of St. Louis. \\\"Producer Price Index by Commodity: All Commodities.\\\" *FRED*, 16 July 2025, fred.stlouisfed.org/series/PPIACO.\n\nLevy, Joseph, et al. \\\"A Transparent and Consistent Approach to Assess US Outpatient Drug Costs for Use in Cost-Effectiveness Analyses.\\\" *Value in Healthâ€¯: The Journal of the International Society for Pharmacoeconomics and Outcomes Research*, U.S. National Library of Medicine, 1 June 2018, pmc.ncbi.nlm.nih.gov/articles/PMC6394851/.\n\nMurphy, Michael, and Jennifer Rodis. \\\"Shedding Light on NADAC: How Pricing Power Influences Pharmacy Reimbursement.\\\" *Shedding Light on NADAC: How Pricing Power Influences Pharmacy Reimbursement \\| The Ohio State University College of Pharmacy*, The Ohio State University College of Pharmacy, 26 June 2025, pharmacy.osu.edu/news/shedding-light-nadac-how-pricing-power-influences-pharmacy-reimbursement#:\\~:text=The%20NADAC%20disruptions%20of%202024,(PBMs)%20for%20drugs%20dispensed.\n\nUnknown. \\\"What Is NADAC & How Does It Differ from AWP?: Capital Rx.\\\" *RSS*, 18 Oct. 2024, www.cap-rx.com/insights/what-is-nadac-how-does-it-differ-from-awp.\n",
    "supporting": [
      "Big-Pharma_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}